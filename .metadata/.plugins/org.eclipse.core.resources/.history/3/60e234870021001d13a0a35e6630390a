package com.unosquare.qachallenge;

import java.util.Iterator;
import java.util.List;

import org.openqa.selenium.Alert;
import org.openqa.selenium.By;
import org.openqa.selenium.Dimension;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

public class xboxPage extends Base{

	public xboxPage(WebDriver driver) {
		super(driver);
		// TODO Auto-generated constructor stub
	}
	
	//Locators
	By windowsLinkLocator = By.id("shellmenu_2");
	By windowsPageLocator = By.cssSelector("button[id='uhfCatLogoButton'][aria-label='Windows']");	
	By searchBtnLocator = By.cssSelector("button[id='search']");	
	By searchTxtBoxLocator = By.id("cli_shellHeaderSearchInput");
	By alertBtnLocator = By.xpath("//button[@title='Permanecer en México - Español']");
	
	By xboxPageLocator = By.xpath("//h2[contains(text(),'Consolas Xbox, juegos y mucho más')]");
	By buynowBtnLocator = By.linkText("Comprar");
	By showAppsBtnLocator = By.cssSelector("a[href*='https://www.microsoft.com/es-mx/search/shop/apps?q=Xbox']");
	By nextBtnLocator = By.xpath("//ul[@class='m-pagination']//li/a/span[.='Siguiente']");
			
	By appsLocator = By.xpath("//div[@class='m-channel-placement-item']");
	By appsNameLocator = By.xpath("//h3[@class='c-subheading-6']");
	By appsWithPriceLocator = By.cssSelector("span[itemprop='price'][content^='MXN']");	
			
	
	/*
	By registerLinkLocator = By.linkText("REGISTER");
	By registerPageLocator = By.xpath("//img[@src='uhfCatLogoButton']");
	By userNameLocator = By.id("email");
	By passwordLocator = By.name("password");
	By confirmPswLocator = By.cssSelector("input[name='confirmPassword']");
	By registerBtnLocator = By.name("submit");
	
	By registeredMessage = By.tagName("font"); //We will use a List of elements and find all the ones that has font ... check registeedMessage
	*/
	
	public void goToXboxShop() throws InterruptedException {
		click(windowsLinkLocator); // click in the link to go to Windows page
		wait(2); 
		List<WebElement> resultList = findElements(windowsPageLocator);	// find out if a WebElement is present	
		if(resultList.size()>0){ //Are we in windows page?
			click(searchBtnLocator);
			sendKeys("Xbox\n",searchTxtBoxLocator);
			Thread.sleep(2000);
			click(alertBtnLocator);
			xboxShop();
		} else { //element was not found in the page
			System.out.println("Windows page was not found"); 
		}
	}
	
	public void xboxShop() throws InterruptedException {
		int NumPages=3; //numero paginas a consultar
		wait(2); 
		List<WebElement> resultList = findElements(xboxPageLocator);	// find out if a WebElement is present
		if(resultList.size()>0){ //Are we in Xbox page?
			click(buynowBtnLocator);
			click(showAppsBtnLocator);
			System.out.println("Total apps in the first " + NumPages + " pages is: " + getAppsNumberAndNames(NumPages));		  
		}else { //element was not found in the page
			System.out.println("Xbox shop page was not found"); //sending message to console
		}
	}
	
		
	
	public int getAppsNumberAndNames (int NumPages) throws InterruptedException {
		Thread.sleep(1000);
		int sumElements=0;
		for (int i = 1; i < NumPages; i++) {
	        WebElement element = findElement(appsLocator); // Get all apps content
	        List<WebElement> elements = element.findElements(appsNameLocator); 	// Get all the apps name
	        for (WebElement e : elements) {
	            System.out.println("App Title: "+ e.getText());
	        }
	        sumElements += elements.size();					
			click(nextBtnLocator);
			Thread.sleep(3000);
		}  
		return sumElements;
	}
	
	public int getNonFree () {
		return 0;
	}
	
	
			
			
			
		/*	
			
			for (int i = 0; i < 3; i++) {
				wait(15);
				List<WebElement> appsList = findElements(appsLocator);
				Iterator<WebElement> itr = appsList.iterator();
				while(itr.hasNext()) {
				    System.out.println(itr.next().getText());
				}
				sumElements += appsList.size();					
				click(nextBtnLocator);				
			}
			System.out.println("Total Apps in the first 3 pages is: " + sumElements);
			
		*/	
	
}
